@page "/demo"
@inject HttpClient httpClient
@inject IJSRuntime JS
@layout MainLayout
@inject NavigationManager Navigation
@implements IAsyncDisposable

@* <h3>Client - Thanh toán</h3>
<input @bind-value="message" />

<button class="btn btn-success" @onclick="ProcessPayment">Thanh toán</button> *@

<style>
    h1 {
        color: #343a40;
        margin-bottom: 20px;
    }

    .table-card {
        width: 200px;
        height: auto;
        background-color: #ffffff;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        margin: 10px;
        transition: transform 0.3s;
    }

        .table-card:hover {
            transform: scale(1.05);
        }

        .table-card img {
            width: 50px;
            height: auto;
            margin-bottom: 10px;
            object-fit: cover;
        }

    .table-number {
        font-size: 20px;
        color: #007bff;
        font-weight: bold;
    }

    .customer-requests {
        font-size: 14px;
        margin-top: 10px;
        text-align: left;
        color: #495057;
    }

    .completion-status {
        color: green;
        font-size: 16px;
        font-weight: bold;
        margin-top: 10px;
        display: none;
    }

    .table-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: start;
        gap: 15px;
    }

    .modal-header {
        background-color: #007bff;
        color: white;
    }

    .search-input {
        margin-bottom: 20px;
        width: 300px;
    }

    .complete-btn {
        background-color: #c81a1a;
        color: black;
    }

        .complete-btn.processing {
            background-color: #c81a1a;
            color: white;
        }

        .complete-btn.completed {
            background-color: green;
            color: white;
        }
</style>

<div class="container mt-5">
    <h1 class="text-center">Quản lý bàn nhà hàng</h1>

    <!-- Search Input -->
    <div class="mb-3 d-flex justify-content-end">
        <input type="text" @bind="searchTerm" class="form-control search-input" placeholder="Tìm bàn..." />
    </div>

    <!-- Accordion for floor management -->
    <div class="accordion" id="tableAccordion">
        <!-- Lầu 1 -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Lầu 1
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#tableAccordion">
                <div class="accordion-body">
                    <div class="table-container" id="tableList1">
                        @foreach (var table in FilterTables(tables1))
                        {
                            <div class="table-card">
                                <img src="@table.Image" alt="Món ăn" />
                                <div class="table-number">@table.Number</div>

                                <div class="customer-requests" style="@(table.IsCompleted ? "display: none;" : "display: block;")">
                                    @foreach (var request in table.Requests)
                                    {
                                        <div>@request</div>
                                    }
                                </div>

                                @if (!table.IsCompleted)
                                {
                                    <button class="btn btn-sm complete-btn @table.ButtonClass" @onclick="() => CompleteTableRequest(table)">
                                        Đang yêu cầu
                                    </button>
                                }
                                <div class="completion-status" style="@(table.IsCompleted ? "display: block;" : "display: none;")">
                                    Hoàn thành
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for completion notification -->
    @if (showModal)
    {
        <div class="modal fade show" tabindex="-1" style="display:block;" aria-labelledby="completeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="completeModalLabel">Thông báo</h5>
                        <button type="button" class="btn-close" @onclick="() => CloseModal()" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Bàn đã hoàn thành yêu cầu!
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @onclick="() => CloseModal()">Đóng</button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
