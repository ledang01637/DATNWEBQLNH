@page "/edittable"
@inject IJSRuntime JS
@inject HttpClient httpClient
<style>
    .table-card {
        transition: transform 0.2s;
    }

    .table-card:hover {
        transform: scale(1.05);
    }

    .floor-container {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
    }

    .grid-item {
        cursor: move;
    }

    .floor {
        margin-bottom: 20px;
    }

    .sortable {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
    }

</style>
@* <div class="container my-4">
    <h1 class="text-center">Floor Management</h1>
    <div class="btn-create mb-2">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#CreateModel">Thêm mới bàn</button>
    </div>

    @if (tables == null || floors == null)
    {
        <p>Loading...</p>
    }
    else
    {
        @foreach (var floor in floors)
        {
            <div class="mb-2">
                <h3>Floor @floor.NumberFloor</h3>
                <div id="sortable-floor-@floor.FloorId" class="sortable">
                    @foreach (var table in tables.Where(t => t.FloorId == floor.FloorId))
                    {
                        <div class="mt-2 grid-item"
                             data-id="@table.TableId"
                             data-position="@table.Position"
                             style="grid-column: @(GetColumnFromPosition(table.Position)); grid-row: @(GetRowFromPosition(table.Position));">
                            <div class="card table-card">
                                <div class="card-body text-center position-relative">
                                    <img src="/img/png/table.png" width="auto" height="50px" alt="Table Image">
                                    <div class="position-absolute top-0 end-0 fw-bold m-1">
                                        <div class="card" style="width: 25px; height: 25px;">
                                            @table.TableNumber
                                        </div>
                                    </div>
                                    <button class="btn text-primary content-btn content-btn-edit"
                                            @onclick="() => LoadTableForEdit(table.TableId)">
                                        <i class="far fa-edit"></i>
                                    </button>
                                    <button class="btn text-danger content-btn content-btn-trash" 
                                            @onclick="() => LoadTableForEdit(table.TableId)"
                                            data-bs-toggle="modal" data-bs-target="#DeleteModel">
                                            <i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    }
    <EditForm Model="@tableModel" OnValidSubmit="UpdateTable">
        <DataAnnotationsValidator />
        <div class="modal-body">
            <div class="form-group">
                <label for="tableNumber" class="form-label">Số bàn:</label>
                <InputNumber class="form-control" min="1" @bind-Value="tableModel.TableNumber" id="tableNumber" name="tableNumber" />
                <ValidationMessage For="@(() => tableModel.TableNumber)" />
            </div>
            <div class="form-group">
                <label for="raw" class="form-label">Chọn hàng</label>
                <InputSelect class="form-control" @onchange="OnRawChange" @bind-Value="row" id="raw" name="raw">
                    <option value="" disabled selected>Chọn hàng</option>
                    @for (int i = 0; i < rowCount; i++)
                    {
                        <option value="Hàng @(i + 1)">Hàng @(i + 1)</option>
                    }
                </InputSelect>
            </div>
            <div class="form-group">
                <label for="column" class="form-label">Chọn cột</label>
                <InputSelect class="form-control" @onchange="OnColumnChange" @bind-Value="column" id="column" name="column">
                    <option value="" disabled selected>Chọn cột</option>
                    @for (int i = 0; i <= 5; i++)
                    {
                        <option value="Cột @(i + 1)">Cột @(i + 1)</option>
                    }
                </InputSelect>
            </div>
            <div class="form-group">
                <label for="Status" class="form-label">Trạng thái</label>
                <InputSelect class="form-control" @bind-Value="tableModel.Status" id="Status" name="Status">
                    @{
                        <option value="" disabled selected>Chọn trạng thái</option>
                        <option value="Bàn trống">Bàn trống</option>
                        <option value="Đã đặt">Đã đặt</option>
                        <option value="Đang dùng">Đang dùng</option>

                    }
                </InputSelect>
                <ValidationMessage For="@(() => tableModel.FloorId)" />
            </div>
            <div class="form-group">
                <label for="seatingCapacity" class="form-label">Sức chứa</label>
                <InputNumber class="form-control" min="1" @bind-Value="tableModel.SeatingCapacity" id="seatingCapacity" name="seatingCapacity" />
                <ValidationMessage For="@(() => tableModel.SeatingCapacity)" />
            </div>
            <div class="form-group">
                <label for="FloorId" class="form-label">Số tầng:</label>
                <InputSelect @onchange="OnFloorChanged" class="form-control" @bind-Value="tableModel.FloorId" id="FloorId" name="FloorId">
                    @{
                        <option value="" disabled selected>Chọn tầng</option>
                        foreach (var floor in floors)
                        {
                            <option value="@floor.FloorId">@floor.NumberFloor</option>
                        }
                    }
                </InputSelect>
                <ValidationMessage For="@(() => tableModel.FloorId)" />
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-success">Cập nhật</button>
        </div>
    </EditForm>
</div> *@


@* AddTable *@
<div class="modal fade" id="CreateModel" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <EditForm Model="@tableModel" OnValidSubmit="AddTable">
                <DataAnnotationsValidator />
                <div class="modal-body">
                    <div class="form-group">
                        <label for="tableNumber" class="form-label">Số bàn:</label>
                        <InputNumber  class="form-control" min="1" @bind-Value="tableModel.TableNumber" id="tableNumber" name="tableNumber" />
                        <ValidationMessage For="@(() => tableModel.TableNumber)" />
                    </div>
                    <div class="form-group">
                        <label for="raw" class="form-label">Chọn hàng</label>
                        <InputSelect class="form-control" @onchange="OnRawChange" @bind-Value="row" id="row" name="row">
                            <option value="" disabled selected>Chọn hàng</option>
                            @for (int i = 0; i < rowCount; i++)
                            {
                                <option value="Hàng @(i + 1)">Hàng @(i + 1)</option>
                            }
                        </InputSelect>
                    </div>
                    <div class="form-group">
                        <label for="column" class="form-label">Chọn cột</label>
                        <InputSelect class="form-control" @onchange="OnColumnChange" @bind-Value="column" id="column" name="column">
                            <option value="" disabled selected>Chọn cột</option>
                            @for (int i = 0; i <= 5; i++)
                            {
                                <option value="Cột @(i + 1)">Cột @(i + 1)</option>
                            }
                        </InputSelect>
                    </div>

                    <div class="form-group">
                        <label for="seatingCapacity" class="form-label">Sức chứa</label>
                        <InputNumber class="form-control" min="1" @bind-Value="tableModel.SeatingCapacity" id="seatingCapacity" name="seatingCapacity" />
                        <ValidationMessage For="@(() => tableModel.SeatingCapacity)" />
                    </div>
                    <div class="form-group">
                        <label for="FloorId" class="form-label">Số tầng:</label>
                        <InputSelect @onchange="OnFloorChanged" class="form-control" @bind-Value="tableModel.FloorId" id="FloorId" name="FloorId">
                            @{
                                <option value="" disabled selected>Chọn tầng</option>
                                foreach (var floor in floors)
                                {
                                    <option value="@floor.FloorId">@floor.NumberFloor</option>
                                }
                            }
                        </InputSelect>
                        <ValidationMessage For="@(() => tableModel.FloorId)" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Thêm</button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@* UpdateTable *@
<div class="modal fade" id="UpdateModel" tabindex="-1" aria-labelledby="UpdateModelLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="UpdateModelLabel">Sửa sản phẩm</h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
        </div> 
    </div>
</div>
@* Delete *@
<div class="modal fade" id="ConfirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa sản phẩm này không?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" @onclick="DeleteTable">Xóa</button>
            </div>
        </div>
    </div>
</div>
